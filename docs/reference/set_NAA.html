<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Specify model and parameter configuration for numbers at age — set_NAA • wham</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Specify model and parameter configuration for numbers at age — set_NAA"><meta property="og:description" content="Specify model and parameter configuration for numbers at age"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wham</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book fa-lg"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/index.html">Overview</a>
    </li>
    <li>
      <a href="../articles/ex01_basics.html">Ex 1: The basics</a>
    </li>
    <li>
      <a href="../articles/ex02_CPI_recruitment.html">Ex 2: Recruitment linked to an environmental covariate (Cold Pool Index)</a>
    </li>
    <li>
      <a href="../articles/ex03_projections.html">Ex 3: Projecting / forecasting random effects</a>
    </li>
    <li>
      <a href="../articles/ex4_selectivity.html">Ex 4: Selectivity with time- and age-varying random effects</a>
    </li>
    <li>
      <a href="../articles/ex05_GSI_M.html">Ex 5: Time-varying natural mortality linked to the Gulf Stream Index</a>
    </li>
    <li>
      <a href="../articles/ex06_NAA.html">Ex 6: Numbers-at-age / survival deviations as random effects</a>
    </li>
    <li>
      <a href="../articles/ex07_debug.html">Ex 7: Debugging WHAM models</a>
    </li>
    <li>
      <a href="../articles/ex08_compare.html">Ex 8: Compare ASAP and WHAM model results</a>
    </li>
    <li>
      <a href="../articles/ex09_retro_pred.html">Ex 9: Retrospective predictions</a>
    </li>
    <li>
      <a href="../articles/ex10_simulation.html">Ex 10: Simulations</a>
    </li>
    <li>
      <a href="../articles/ex11_catchability.html">Ex 11: Catchability configurations</a>
    </li>
    <li>
      <a href="../articles/ex12_multistock.html">Ex 12: Multiple stocks, regions</a>
    </li>
    <li>
      <a href="../articles/ex13_no_ASAP.html">Ex 13: WHAM without ASAP</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code fa-lg"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/timjmiller/wham/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    Source code
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-bullhorn fa-lg"></span>
     
    News
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/timjmiller/wham/issues/" class="external-link">
    <span class="fas fa-question-circle fa-lg"></span>
     
    Issues
  </a>
</li>
<li>
  <a href="https://www.fisheries.noaa.gov/contact/timothy-miller-phd" class="external-link">
    <span class="fas fa-paper-plane fa-lg"></span>
     
    Contact
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Specify model and parameter configuration for numbers at age</h1>
    <small class="dont-index">Source: <a href="https://github.com/timjmiller/wham/blob/HEAD/R/set_NAA.R" class="external-link"><code>R/set_NAA.R</code></a></small>
    <div class="hidden name"><code>set_NAA.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Specify model and parameter configuration for numbers at age</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">set_NAA</span><span class="op">(</span><span class="va">input</span>, NAA_re <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>input</dt>
<dd><p>list containing data, parameters, map, and random elements (output from <code><a href="prepare_wham_input.html">prepare_wham_input</a></code>)</p></dd>


<dt>NAA_re</dt>
<dd><p>(optional) list specifying options for numbers-at-age random effects, initial parameter values, and recruitment model (see details)</p>
<p>If <code>NAA_re = NULL</code>, a traditional statistical catch-at-age model is fit (NAA = pred_NAA for all ages, deterministic). Otherwise,
<code>NAA_re</code> specifies numbers-at-age configuration. It is a list with the following possible entries:</p><dl><dt>$decouple_recruitment</dt>
<dd><p>T/F determining whether correlation structure of recruitment is independent of RE deviations for older ages 
       (default = TRUE). Only applicable for <code>NAA_re$sigma = "rec+1"</code> and correlation across ages is specified. If TRUE and <code>NAA_re$cor = "ar1_a"</code>, only deviations for ages&gt;1 
       have the correlation structure. If TRUE and NAA_re$cor is "ar1_y" or "2dar1" separate year correlation parameters are estimated for recruitment and older
       ages.</p></dd>

    <dt>$sigma</dt>
<dd><p>Which ages allow deviations from the predicted NAA given NAA from previous time step? Must be a single character string described below or a vector
                   of length n_stocks. If length = 1, assumptions will be applied to all stocks. Options are specified with the strings:</p><dl><dt>"rec"</dt>
<dd><p>Random effects on recruitment (deviations), all other ages deterministic</p></dd>

                     <dt>"rec+1"</dt>
<dd><p>"Full state space" model with 2 estimated <code>sigma_a</code>, one for recruitment and one shared among other ages</p></dd>

                   
</dl><p></p></dd>

    <dt>$sigma_vals</dt>
<dd><p>Array (n_stocks x n_regions x n_ages) of initial standard deviation values to use for the NAA deviations. Values are not used if recruit_model = 1 and <code>NAA_re$sigma</code> is
                 not specified. Only those for age 1 in the spawning region are used if <code>NAA_re$sigma</code> = "rec".
                 If <code>NAA_re$sigma_map</code> is defined, the user must ensure that the configuration is compatible with <code>NAA_re$sigma_vals</code></p></dd>

    <dt>$sigma_map</dt>
<dd><p>You can specify a more complex parameter configuration by entering an integer array (nstocks x n_regions x n_ages), where each entry points to the
                  NAA_sigma to use for that stock and age. E.g., for 2 stocks, 2 regions, and 6 ages, array(rep(c(1,2,2,3,3,3), each = 4),c(2,2,6)) will estimate 3 
                  sigmas, with recruitment (age-1) deviations having their own <code>sigma_R</code>, ages 2-3 sharing <code>sigma_2</code>, and ages 4-6 sharing <code>sigma_3</code>. 
                  All parameters being the same for both stocks and across regions. The user must be sure that a compatible <code>NAA_re$sigma</code> configuration is defined.
                  Values are not used if recruit_model = 1 and <code>NAA_re$sigma</code> is not specified.</p></dd>

    <dt>$cor</dt>
<dd><p>Correlation structure for the NAA deviations. Must be a single character string described below or a vector
                 of length n_stocks. If length = 1, assumptions will be applied to all stocks. Options are:</p><dl><dt>"iid"</dt>
<dd><p>NAA deviations vary by year and age, but uncorrelated.</p></dd>

                   <dt>"ar1_a"</dt>
<dd><p>NAA deviations correlated by age (AR1).</p></dd>

                   <dt>"ar1_y"</dt>
<dd><p>NAA deviations correlated by year (AR1).</p></dd>

                   <dt>"2dar1"</dt>
<dd><p>NAA deviations correlated by year and age (2D AR1).</p></dd>

                 
</dl><p></p></dd>

    <dt>$cor_vals</dt>
<dd><p>Array (n_stocks x n_regions x 3) of initial correlation values to use for the NAA deviations. The first value correspond to correlation across age.
                 The second is for yearly correlation for NAA deviations for all ages if recruitment is not decoupled, or otherwise just ages after recruitemnt. The third correlation is for annual 
                 recruitment deviations and used only when recruitment is decoupled. If unspecified all initial values are 0. If <code>NAA_re$cor</code> = "iid", values are not used. 
                 If <code>NAA_re$cor</code> = "ar1_a", those for yearly correlation are not used, and vice versa for "ar1_y".</p></dd>

    <dt>$cor_map</dt>
<dd><p>n_stocks x n_region matrix x 3 array of NA or integers indicating which random effects correlation parameters are estimated
      and whether to set any to be estimated identically. The 3 values for a given stock and region are for age, year ("survival"), and year ("recruitment"). 
      Both age and years values are used for <code>NAA_re$cor = "2dar1"</code>, but only the appropriate values are used for <code>NAA_re$cor = "ar1_a"</code>, or <code>"ar1_y"</code>.
      When <code>NAA_re$decouple_recruitment = TRUE</code>, the third value is used for both <code>NAA_re$sigma = "rec"</code> or <code>"rec+1"</code>. For 
      <code>NAA_re$decouple_recruitment = FALSE</code>, only the second value is used and applies to both recruitment and "survival" when <code>NAA_re$sigma = "rec+1"</code>, 
      and just recruitment when <code>NAA_re$sigma = "rec"</code>. If not supplied stock-specific values for age and/or year will be estimated for all regions where 
      <code>NAA_re$cor</code> is other than "none", "iid".</p></dd>

    <dt>$N1_model</dt>
<dd><p>Character vector (n_stocks) determining which way to model the initial numbers at age:</p><dl><dt>"age-specific-fe"</dt>
<dd><p>(default) age- and region-specific fixed effects parameters</p></dd>

         <dt>"equilibrium"</dt>
<dd><p>2 fixed effects parameters: an initial recruitment and an instantaneous fishing mortality rate to generate an equilibruim abundance at age.</p></dd>

         <dt>"iid-re"</dt>
<dd><p>(default) age- and region-specific iid random effects parameters. 2 parameters: mean and sd for log NAA</p></dd>

         <dt>"ar1-re"</dt>
<dd><p>(default) age- and region-specific random effects parameters. 3 parameters: mean and sd, and cor for log NAA</p></dd>

      
</dl><p></p></dd>

    <dt>$N1_pars</dt>
<dd><p>An (n_stocks x n_regions x n_ages) array. If N1_model = 0, then this should be filled with the initial values to use for abundance at age by stock and region in the first year. 
       If N1_model = 1 (equilibrium assumption), only the first two values in the ages dimension are used: the (s,r,1) value is recruitment for stock (and region) and (s,r,2) is the fully-selected 
       equilibrium fishing mortality rate generating the rest of the numbers at age in the first year.</p></dd>

    <dt>$recruit_model</dt>
<dd><p>Integer vector (n_stocks) determining how to model recruitment. Overrides <code>recruit_model</code> argument to <code>prepare_wham_input</code>. Must make sure <code>NAA_re$sigma</code>, <code>NAA_re$cor</code>
       and <code>ecov</code> are properly specified.</p><dl><dt>1</dt>
<dd><p>SCAA, estimating annual recruitments as fixed effects.</p></dd>

          <dt>2</dt>
<dd><p>estimating a mean recruitment with annual recruitments as random effects</p></dd>

          <dt>3</dt>
<dd><p>Beverton-Holt stock-recruitment with annual recruitments as random effects</p></dd>

          <dt>4</dt>
<dd><p>Ricker stock-recruitment with annual recruitments as random effects</p></dd>

      
</dl><p></p></dd>

    <dt>$recruit_pars</dt>
<dd><p>list (length = n_stocks) of vectors of initial parameters for recruitment model. If $recruit_model is 3 or 4, parameters are "alpha" and "beta".</p></dd>

  
</dl></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a named list with same elements as the input provided with abundance modeling options modified.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="prepare_wham_input.html">prepare_wham_input</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">wham.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"wham"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">path_to_examples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package<span class="op">=</span><span class="st">"wham"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">asap3</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_asap3_dat.html">read_asap3_dat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path_to_examples</span>,<span class="st">"ex1_SNEMAYT.dat"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span><span class="va">asap3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">NAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="st">"rec"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="set_q.html">set_q</a></span><span class="op">(</span><span class="va">input</span>, NAA_re <span class="op">=</span> <span class="va">NAA</span><span class="op">)</span> <span class="co">#estimate recruitment as random effects</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tim Miller, Brian Stock.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

