<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ex 11: Catchability • wham</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Ex 11: Catchability">
<meta property="og:description" content="wham">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wham</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.0.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book fa-lg"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Overview</a>
    </li>
    <li>
      <a href="../articles/ex01_basics.html">Ex 1: The basics</a>
    </li>
    <li>
      <a href="../articles/ex02_CPI_recruitment.html">Ex 2: Recruitment linked to an environmental covariate (Cold Pool Index)</a>
    </li>
    <li>
      <a href="../articles/ex03_projections.html">Ex 3: Projecting / forecasting random effects</a>
    </li>
    <li>
      <a href="../articles/ex4_selectivity.html">Ex 4: Selectivity with time- and age-varying random effects</a>
    </li>
    <li>
      <a href="../articles/ex05_GSI_M.html">Ex 5: Time-varying natural mortality linked to the Gulf Stream Index</a>
    </li>
    <li>
      <a href="../articles/ex06_NAA.html">Ex 6: Numbers-at-age / survival deviations as random effects</a>
    </li>
    <li>
      <a href="../articles/ex07_debug.html">Ex 7: Debugging WHAM models</a>
    </li>
    <li>
      <a href="../articles/ex08_compare.html">Ex 8: Compare ASAP and WHAM model results</a>
    </li>
    <li>
      <a href="../articles/ex09_retro_pred.html">Ex 9: Retrospective predictions</a>
    </li>
    <li>
      <a href="../articles/ex10_simulation.html">Ex 10: Simulations</a>
    </li>
    <li>
      <a href="../articles/ex11_catchability.html">Ex 11: Catchability configurations</a>
    </li>
    <li>
      <a href="../articles/ex12_multistock.html">Ex 12: Multiple stocks, regions</a>
    </li>
    <li>
      <a href="../articles/ex13_no_ASAP.html">Ex 13: WHAM without ASAP</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code fa-lg"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/timjmiller/wham/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    Source code
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-bullhorn fa-lg"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/timjmiller/wham/issues/" class="external-link">
    <span class="fas fa-question-circle fa-lg"></span>
     
    Issues
  </a>
</li>
<li>
  <a href="https://www.fisheries.noaa.gov/contact/timothy-miller-phd" class="external-link">
    <span class="fas fa-paper-plane fa-lg"></span>
     
    Contact
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ex 11: Catchability</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/timjmiller/wham/blob/HEAD/vignettes/ex11_catchability.Rmd" class="external-link"><code>vignettes/ex11_catchability.Rmd</code></a></small>
      <div class="hidden name"><code>ex11_catchability.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">1. Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This is the 11th WHAM example. We assume you already have
<code>wham</code> installed and are relatively familiar with the
package. If not, read the <a href="https://timjmiller.github.io/wham/">Introduction</a> and <a href="https://timjmiller.github.io/wham/articles/">Tutorial</a>.</p>
<p>In this vignette we show how to both simulate and estimate:</p>
<ul>
<li>A prior distribution and random effect for catchability.</li>
<li>Allow time-varying catchability as a random effect.</li>
<li>Environmental covariate effect on catchability</li>
<li>Different effects of the same environmental covariate on
catchability and recruitment.</li>
</ul>
</div>
<div class="section level2">
<h2 id="setup">2. Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github("timjmiller/wham", dependencies=TRUE)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://timjmiller.github.io/wham/">wham</a></span><span class="op">)</span></span></code></pre></div>
<p>Create a directory for this analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># choose a location to save output, otherwise will be saved in working directory</span></span>
<span><span class="va">write.dir</span> <span class="op">&lt;-</span> <span class="st">"choose/where/to/save/output"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">write.dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">write.dir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-simple-operating-model">3. A simple operating model<a class="anchor" aria-label="anchor" href="#a-simple-operating-model"></a>
</h2>
<p>Make a lists of information to pass to the <code>basic_info</code> ,
<code>catch_info</code>, <code>index_info</code> and <code>F</code>
arguments of <code>prepare_wham_input</code>. These components will
define a simple default stock and observations on it. We’ll then use the
input with <code>fit_wham</code> to create operating and estimating
models. This similar to example 10, but now there are two indices.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_digifish</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">years</span> <span class="op">=</span> <span class="fl">1975</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">digifish</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">years</span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="va">na</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span></span>
<span>    <span class="va">ny</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">maturity</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span> <span class="op">-</span> <span class="va">na</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">na</span>, <span class="va">ny</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">ny</span>,<span class="va">na</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">L</span> <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span> <span class="op">-</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span><span class="op">*</span><span class="va">L</span><span class="op">^</span><span class="fl">3</span></span>
<span>    <span class="va">nwaa</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">waa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">na</span>, <span class="va">ny</span><span class="op">)</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">ny</span>, <span class="va">na</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">fracyr_SSB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="va">ny</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">bias_correct_process</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="va">digifish</span><span class="op">$</span><span class="va">bias_correct_observation</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">digifish</span> <span class="op">=</span> <span class="fu">make_digifish</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">catch_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">catch_info</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">catch_info</span><span class="op">$</span><span class="va">catch_cv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span></span>
<span><span class="va">catch_info</span><span class="op">$</span><span class="va">catch_Neff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span></span>
<span><span class="va">catch_info</span><span class="op">$</span><span class="va">selblock_pointer_fleets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">index_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">index_cv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">index_Neff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">fracyr_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">units_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span> <span class="co">#abundance</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">units_index_paa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span> <span class="co">#abundance</span></span>
<span><span class="va">index_info</span><span class="op">$</span><span class="va">selblock_pointer_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">F_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">catch_info</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now define <code>selectivity</code> and <code>M</code> arguments for
<code>prepare_wham_input</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selectivity</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"logistic"</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"logistic"</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    initial_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">+</span> <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">)</span> <span class="co">#fleet, index</span></span>
<span></span>
<span><span class="va">M</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here we specify recruitment deviations are independent random effects
and no stock-recruit relationship will be assumed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NAA_re</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  N1_model <span class="op">=</span> <span class="st">"age-specific-fe"</span>, </span>
<span>  N1_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">M</span><span class="op">$</span><span class="va">initial_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">NAA_re</span><span class="op">$</span><span class="va">sigma</span> <span class="op">=</span> <span class="st">"rec"</span> <span class="co">#random about mean</span></span>
<span><span class="co">#NAA_re$use_steepness = 0</span></span>
<span><span class="va">NAA_re</span><span class="op">$</span><span class="va">recruit_model</span> <span class="op">=</span> <span class="fl">2</span> <span class="co">#random effects with a constant mean</span></span>
<span><span class="va">NAA_re</span><span class="op">$</span><span class="va">recruit_pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-the-q-parameter-for-the-second-index-to-have-a-prior-distribution-">4. Setting up the q parameter for the second index to have a prior
distribution.<a class="anchor" aria-label="anchor" href="#setting-up-the-q-parameter-for-the-second-index-to-have-a-prior-distribution-"></a>
</h2>
<p>We can use the <code>initial_q</code> and <code>prior_sd</code>
components of the <code>catchability</code> argument to specify a normal
prior distribution for logit catchability of one or more indices. The
lower and upper bounds of each catchability can be defined using
<code>q_lower</code> and <code>q_upper</code> elements of the
<code>cactchability</code> argument, but they are 0 and 1000 by default.
Entries in <code>prior_sd</code> that are <code>NA</code> do not have
time-varying random effects values and the corresponding value
<code>initial_q</code> will be the initial value when estimated or the
assumed catchability for simulation for an operating model. Non-NA
entries in <code>prior_sd</code> define the standard deviation of the
normal prior distribution and the corresponding value of
<code>initial_q</code> is the inverse-logit of the mean of the prior
distribution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catchability</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>, prior_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can make the input list with
<code>prepare_wham_input</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, catchability <span class="op">=</span> <span class="va">catchability</span>,</span>
<span>  index_info <span class="op">=</span> <span class="va">index_info</span>, catch_info <span class="op">=</span> <span class="va">catch_info</span>, F <span class="op">=</span> <span class="va">F_info</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then define an operating model (OM) and simulate data as well
as random effects for the q of the second survey and recruitment from
this input. Note we first remove any parameters from the random
component of the input so that TMB will not try to optimize these random
effects if it would normallly when estimating a model. This is not
necessary here, but it was for the closed-loop simulations in example
10, and would seem to be a good habit.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om_input</span> <span class="op">&lt;-</span> <span class="va">input</span></span>
<span><span class="va">om_input</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#simulate data from operating model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0101010</span><span class="op">)</span></span>
<span><span class="va">newdata</span> <span class="op">=</span> <span class="va">om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Now put the simulated data in an input file with all the same
configuration as the operating model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">=</span> <span class="va">input</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">newdata</span></span></code></pre></div>
<p>Fit an estimation model that is the same as the operating model
(self-test).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, do.retro<span class="op">=</span><span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>This plot of the q prior and approximate posterior is provided by
<code>plot_wham_output</code>. The true simulated q is shown as the
solid vertical line.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">wham</span><span class="fu">:::</span><span class="fu">plot_q_prior_post</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">newdata</span><span class="op">$</span><span class="va">q</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex11_plots/prior_posterior_q.png" style="width:80.0%"></p>
</div>
<div class="section level2">
<h2 id="add-random-effects-on-q-for-first-index">5. Add random effects on q for first index<a class="anchor" aria-label="anchor" href="#add-random-effects-on-q-for-first-index"></a>
</h2>
<p>This will add time varying iid random effects on catchability for the
first index while still keeping the prior on the second index. We
specify the standard deviation of the catchability of the random effects
on the logit scale with <code>sigma_val</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catchability</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.3</span><span class="op">)</span>, initial_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>, re <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iid"</span>, <span class="st">"none"</span><span class="op">)</span>, sigma_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Generate input as above.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, catchability <span class="op">=</span> <span class="va">catchability</span>,</span>
<span>  index_info <span class="op">=</span> <span class="va">index_info</span>, catch_info <span class="op">=</span> <span class="va">catch_info</span>, F <span class="op">=</span> <span class="va">F_info</span><span class="op">)</span></span></code></pre></div>
<p>Now create the operating model, simulate data and fit as above</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om_input</span> <span class="op">&lt;-</span> <span class="va">input</span></span>
<span><span class="va">om_input</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#simulate data from operating model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0101010</span><span class="op">)</span></span>
<span><span class="va">newdata</span> <span class="op">=</span> <span class="va">om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put the simulated data in an input file with all the same configuration as the operating model</span></span>
<span><span class="va">temp</span> <span class="op">=</span> <span class="va">input</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">newdata</span></span>
<span></span>
<span><span class="co">#fit estimating model that is the same as the operating model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, do.retro<span class="op">=</span><span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>This is similar to what is provided in <code>plot_wham_output</code>,
but with the true values from the simulation also plotted</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal</span> <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">'n'</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"q"</span>, xlab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">se</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">==</span> <span class="st">"logit_q_mat"</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">polyy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>, <span class="va">polyy</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha.f<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">newdata</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Index "</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" Est."</span>, <span class="st">" True"</span><span class="op">)</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pal</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex11_plots/q_time_series_1.png" style="width:80.0%"></p>
</div>
<div class="section level2">
<h2 id="add-environmental-covariates-to-the-model">6. Add Environmental covariates to the model<a class="anchor" aria-label="anchor" href="#add-environmental-covariates-to-the-model"></a>
</h2>
<p>First simulate and estimate environmental covariate processes, but no
effects of population.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecov</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Climate variable 1"</span>, <span class="st">"Climate variable 2"</span><span class="op">)</span>,</span>
<span>        process_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ar1"</span>,<span class="st">"ar1"</span><span class="op">)</span>,</span>
<span>        mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        logsigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        years <span class="op">=</span> <span class="va">digifish</span><span class="op">$</span><span class="va">years</span>, </span>
<span>        use_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,  </span>
<span>        q_how <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">process_mean_vals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span> <span class="co">#mean</span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">process_sig_vals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span><span class="op">)</span> <span class="co">#sd</span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">process_cor_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span>  <span class="co">#cor</span></span></code></pre></div>
<p>We use <code>process_mean_vals</code>, <code>process_sig_vals</code>
and <code>process_cor_vals</code> to specify parameters for the AR1
processes assumed for the environmental covariate processes. Note that
<code>ecov$q_how</code> is a matrix with rows for indices and columns
for covariates for whether each covariate affects an index. Note also,
that the simulated values for the observations for each covariate here
will not be used.</p>
<p>We will not include a prior distribution for the second index, but we
will keep the iid random effects on q for the first index.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catchability</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>, sigma_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.3</span><span class="op">)</span>, re <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iid"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, catchability <span class="op">=</span> <span class="va">catchability</span>, ecov <span class="op">=</span> <span class="va">ecov</span>,</span>
<span>  index_info <span class="op">=</span> <span class="va">index_info</span>, catch_info <span class="op">=</span> <span class="va">catch_info</span>, F <span class="op">=</span> <span class="va">F_info</span><span class="op">)</span></span></code></pre></div>
<p>Now create the operating model and simulate and fit data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om_input</span> <span class="op">&lt;-</span> <span class="va">input</span></span>
<span><span class="va">om_input</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0101010</span><span class="op">)</span></span>
<span><span class="va">newdata</span> <span class="op">=</span> <span class="va">om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put the simulated data in an input file with all the same configuration as the operating model</span></span>
<span><span class="va">temp</span> <span class="op">=</span> <span class="va">input</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">newdata</span></span>
<span></span>
<span><span class="co">#fit estimating model that is the same as the operating model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, do.retro <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>Check the table of parameter estimates on the second tab of the html
document produced by <code>plot_wham_output</code>. It shows parameter
estiamtes, standard errors, and confidence intervals on the natural
scale of the parameters.</p>
<p>Again, this is similar to what is provided in
<code>plot_wham_output</code>, but with the true values from the
simulation also plotted.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal</span> <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">se</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">==</span> <span class="st">"logit_q_mat"</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">'n'</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"q"</span>, xlab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">polyy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>, <span class="va">polyy</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha.f<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">newdata</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Index "</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" Est."</span>, <span class="st">" True"</span><span class="op">)</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pal</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex11_plots/q_time_series_2.png" style="width:80.0%"></p>
<p>Let’s take a look at the true and estimated environmental covariate
process pararameters. Columns are the different covariates. Rows are the
mean, sd, and correlation parameters, respectively.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">Ecov_process_pars</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">Ecov_process_pars</span></span></code></pre></div>
<p>Compare true and estimated (log) standard deviation of time-varying
q. First row, first column.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">q_repars</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">q_repars</span></span></code></pre></div>
<p>The estimated variability in q is lower than truth, but the estimate
has large standard error:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span>, <span class="st">"Std"</span><span class="op">)</span><span class="op">$</span><span class="va">q_repars</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="environmental-effects-on-catchability">7. Environmental effects on catchability<a class="anchor" aria-label="anchor" href="#environmental-effects-on-catchability"></a>
</h2>
<p>Allow effects of first Environmental covariate on q for second
index.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecov</span><span class="op">$</span><span class="va">q_how</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"none"</span>,<span class="st">"lag-0-linear"</span>,<span class="st">"none"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#set value for Ecov_beta effect on q (dims are n_effects (n_indices, n_Ecov, max_n_poly)</span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">beta_q_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">index_info</span><span class="op">$</span><span class="va">n_indices</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ecov</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">beta_q_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></code></pre></div>
<p>We set the value for effect of the environmental covariate on q using
<code>ecov$beta_q_vals</code> (array dims are n_indices, n_Ecov, order
of the polynomial).</p>
<p>As above, generate input.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, catchability <span class="op">=</span> <span class="va">catchability</span>, ecov <span class="op">=</span> <span class="va">ecov</span>,</span>
<span>  index_info <span class="op">=</span> <span class="va">index_info</span>, catch_info <span class="op">=</span> <span class="va">catch_info</span>, F <span class="op">=</span> <span class="va">F_info</span><span class="op">)</span></span></code></pre></div>
<p>As above, create the operating model, simulate and fit data and
compare true and estimated parameters.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om_input</span> <span class="op">&lt;-</span> <span class="va">input</span></span>
<span><span class="va">om_input</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0101010</span><span class="op">)</span></span>
<span><span class="va">newdata</span> <span class="op">=</span> <span class="va">om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put the simulated data in an input file with all the same configuration as the operating model</span></span>
<span><span class="va">temp</span> <span class="op">=</span> <span class="va">input</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">newdata</span></span>
<span></span>
<span><span class="co">#fit estimating model that is the same as the operating model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, do.retro <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#compare assumed and estimated ecov process pars</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">Ecov_beta</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">Ecov_beta</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#compare assumed and estimated ecov process pars</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">Ecov_process_pars</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">Ecov_process_pars</span></span>
<span></span>
<span></span>
<span><span class="co">#compare true and estimated time-varying q</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">q_repars</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">q_repars</span></span>
<span><span class="co">#estimated variability in q is lower than truth, but estimate has large SE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span>, <span class="st">"Std"</span><span class="op">)</span><span class="op">$</span><span class="va">q_repars</span></span>
<span></span>
<span><span class="va">pal</span> <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">se</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">==</span> <span class="st">"logit_q_mat"</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">'n'</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"q"</span>, xlab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">polyy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>, <span class="va">polyy</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha.f<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">newdata</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Index "</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" Est."</span>, <span class="st">" True"</span><span class="op">)</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pal</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex11_plots/q_time_series_3.png" style="width:80.0%"></p>
</div>
<div class="section level2">
<h2 id="different-effects-on-q-and-recruitment-of-the-same-environmental-covariate-">8. Different effects on q and recruitment of the same environmental
covariate.<a class="anchor" aria-label="anchor" href="#different-effects-on-q-and-recruitment-of-the-same-environmental-covariate-"></a>
</h2>
<p>Add covariates to the model and allow effects of first covariate on q
for second index AND recruitment. Then proceed as above. Use
ecov$beta_R_vals to specify effect size of covariate on recruitment.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecov</span><span class="op">$</span><span class="va">recruitment_how</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"controlling-lag-0-linear"</span>,<span class="st">"none"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#set value for Ecov_beta effect on recruitment (dims are n_effects (2 + n_indices, max_n_poly, n_Ecov, n_ages)</span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">beta_R_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ecov</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ecov</span><span class="op">$</span><span class="va">beta_R_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.5</span></span>
<span></span>
<span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, catchability <span class="op">=</span> <span class="va">catchability</span>, ecov <span class="op">=</span> <span class="va">ecov</span>,</span>
<span>  index_info <span class="op">=</span> <span class="va">index_info</span>, catch_info <span class="op">=</span> <span class="va">catch_info</span>, F <span class="op">=</span> <span class="va">F_info</span><span class="op">)</span></span></code></pre></div>
<p>Create the operating model, simulate and fit data, and compare true
and estimated parameters.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om_input</span> <span class="op">&lt;-</span> <span class="va">input</span></span>
<span><span class="va">om_input</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0101010</span><span class="op">)</span></span>
<span><span class="va">newdata</span> <span class="op">=</span> <span class="va">om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put the simulated data in an input file with all the same configuration as the operating model</span></span>
<span><span class="va">temp</span> <span class="op">=</span> <span class="va">input</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">newdata</span></span>
<span></span>
<span><span class="co">#fit estimating model that is the same as the operating model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, do.retro <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#compare assumed and estimated ecov effect on q for second index</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">Ecov_beta_q</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">Ecov_beta_q</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#compare assumed and estimated ecov effect on recruitment</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">Ecov_beta_R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">Ecov_beta_R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#SE for beta parameters is large, especially for recruitment effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span>, <span class="st">"Std"</span><span class="op">)</span><span class="op">$</span><span class="va">Ecov_beta_q</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span>, <span class="st">"Std"</span><span class="op">)</span><span class="op">$</span><span class="va">Ecov_beta_R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#compare assumed and estimated ecov process pars</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">Ecov_process_pars</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">Ecov_process_pars</span></span>
<span></span>
<span><span class="co">#compare true and estimated time-varying q</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">q_repars</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">parList</span><span class="op">$</span><span class="va">q_repars</span></span>
<span></span>
<span><span class="co">#estimated variability in q is lower than truth, but estimate has large SE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span>, <span class="st">"Std"</span><span class="op">)</span><span class="op">$</span><span class="va">q_repars</span></span>
<span></span>
<span><span class="va">pal</span> <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">se</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">==</span> <span class="st">"logit_q_mat"</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">'n'</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.6</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"q"</span>, xlab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">polyy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>, <span class="va">polyy</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha.f<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">years</span>, <span class="va">newdata</span><span class="op">$</span><span class="va">q</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Index "</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_indices</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" Est."</span>, <span class="st">" True"</span><span class="op">)</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pal</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex11_plots/q_time_series_4.png" style="width:80.0%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tim Miller, Brian Stock.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
