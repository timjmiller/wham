<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ex 10: Operating models and MSE • wham</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Ex 10: Operating models and MSE">
<meta property="og:description" content="wham">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wham</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.6.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book fa-lg"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Overview</a>
    </li>
    <li>
      <a href="../articles/ex1_basics.html">Ex 1: The basics</a>
    </li>
    <li>
      <a href="../articles/ex2_CPI_recruitment.html">Ex 2: Recruitment linked to an environmental covariate (Cold Pool Index)</a>
    </li>
    <li>
      <a href="../articles/ex3_projections.html">Ex 3: Projecting / forecasting random effects</a>
    </li>
    <li>
      <a href="../articles/ex4_selectivity.html">Ex 4: Selectivity with time- and age-varying random effects</a>
    </li>
    <li>
      <a href="../articles/ex5_GSI_M.html">Ex 5: Time-varying natural mortality linked to the Gulf Stream Index</a>
    </li>
    <li>
      <a href="../articles/ex6_NAA.html">Ex 6: Numbers-at-age / survival deviations as random effects</a>
    </li>
    <li>
      <a href="../articles/ex7_debug.html">Ex 7: Debugging WHAM models</a>
    </li>
    <li>
      <a href="../articles/ex8_compare.html">Ex 8: Compare ASAP and WHAM model results</a>
    </li>
    <li>
      <a href="../articles/ex9_retro_pred.html">Ex 9: Retrospective predictions</a>
    </li>
    <li>
      <a href="../articles/ex10_om_mse.html">Ex 10: Operating models and MSE</a>
    </li>
    <li>
      <a href="../articles/ex11_catchability.html">Ex 11: Catchability configurations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code fa-lg"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/timjmiller/wham/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    Source code
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-bullhorn fa-lg"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/timjmiller/wham/issues/" class="external-link">
    <span class="fas fa-question-circle fa-lg"></span>
     
    Issues
  </a>
</li>
<li>
  <a href="https://www.fisheries.noaa.gov/contact/timothy-miller-phd" class="external-link">
    <span class="fas fa-paper-plane fa-lg"></span>
     
    Contact
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ex 10: Operating models and MSE</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/timjmiller/wham/blob/HEAD/vignettes/ex10_om_mse.Rmd" class="external-link"><code>vignettes/ex10_om_mse.Rmd</code></a></small>
      <div class="hidden name"><code>ex10_om_mse.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">1. Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This is the 10th WHAM example. We assume you already have
<code>wham</code> installed and are relatively familiar with the
package. If not, read the <a href="https://timjmiller.github.io/wham/">Introduction</a> and <a href="https://timjmiller.github.io/wham/articles/">Tutorial</a>.</p>
<p>In this vignette we show how to:</p>
<ul>
<li>Make a default wham input file <strong>without an ASAP3 dat
file</strong>.</li>
<li>Make an operating model, simulate data, and fit models</li>
<li>Perform a simple management strategy evaluation (MSE) using an
operating model with Beverton-Holt stock recruitment and a SCAA
estimating model</li>
<li>Make some plots</li>
</ul>
</div>
<div class="section level2">
<h2 id="setup">2. Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># devtools::install_github("timjmiller/wham", dependencies=TRUE)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://timjmiller.github.io/wham/">wham</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>Create a directory for this analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># choose a location to save output, otherwise will be saved in working directory</span>
<span class="va">write.dir</span> <span class="op">&lt;-</span> <span class="st">"choose/where/to/save/output"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">write.dir</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">write.dir</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-simple-operating-model-and-two-estimation-models">3. A simple operating model and two estimation models<a class="anchor" aria-label="anchor" href="#a-simple-operating-model-and-two-estimation-models"></a>
</h2>
<p>Make a <code>basic_info</code> list of input components defining a
simple default stock. We’ll then pass this to
<code>prepare_wham_input</code> and <code>fit_wham</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_digifish</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">years</span> <span class="op">=</span> <span class="fl">1975</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">digifish</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">ages</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">years</span> <span class="op">=</span> <span class="va">years</span>
    <span class="va">na</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span>
    <span class="va">ny</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>

    <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">=</span> <span class="fl">1</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">catch_cv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="va">ny</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">catch_Neff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">200</span>, <span class="va">ny</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span> <span class="op">=</span> <span class="fl">1</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">index_cv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">ny</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">index_Neff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">ny</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">fracyr_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">ny</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">index_units</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">)</span> <span class="co">#biomass</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">index_paa_units</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">)</span> <span class="co">#abundance</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">maturity</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span> <span class="op">-</span> <span class="va">na</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">na</span>, <span class="va">ny</span><span class="op">)</span><span class="op">)</span>

    <span class="va">L</span> <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span> <span class="op">-</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span><span class="op">*</span><span class="va">L</span><span class="op">^</span><span class="fl">3</span>
    <span class="va">nwaa</span> <span class="op">=</span> <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span> <span class="op">+</span> <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">+</span> <span class="fl">2</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">waa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nwaa</span>, <span class="va">ny</span>, <span class="va">na</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nwaa</span><span class="op">)</span> <span class="va">digifish</span><span class="op">$</span><span class="va">waa</span><span class="op">[</span><span class="va">i</span>,,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">na</span>, <span class="va">ny</span><span class="op">)</span><span class="op">)</span>

    <span class="va">digifish</span><span class="op">$</span><span class="va">fracyr_SSB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="va">ny</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">q</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="cn">F</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="va">ny</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span>

    <span class="va">digifish</span><span class="op">$</span><span class="va">selblock_pointer_fleets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span>, <span class="va">ny</span><span class="op">)</span><span class="op">)</span>
    <span class="va">digifish</span><span class="op">$</span><span class="va">selblock_pointer_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span>, <span class="va">ny</span><span class="op">)</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">digifish</span> <span class="op">=</span> <span class="fu">make_digifish</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Now define other components needed by <code>prepare_wham_input</code>
(selectivity and M).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selectivity</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"logistic"</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"logistic"</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">)</span>,
    initial_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">digifish</span><span class="op">$</span><span class="va">n_fleets</span> <span class="op">+</span> <span class="va">digifish</span><span class="op">$</span><span class="va">n_indices</span><span class="op">)</span><span class="op">)</span> <span class="co">#fleet, index</span>

<span class="va">M</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here we specify that recruitment deviations are independent random
effects, with no stock-recruit relationship.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NAA_re</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N1_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">M</span><span class="op">$</span><span class="va">initial_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">sigma</span> <span class="op">=</span> <span class="st">"rec"</span> <span class="co">#random about mean</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">use_steepness</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">recruit_model</span> <span class="op">=</span> <span class="fl">2</span> <span class="co">#random effects with a constant mean</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">recruit_pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Now we can make the input list with
<code>prepare_wham_input</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span><span class="op">)</span></code></pre></div>
<p>We can then define an operating model (OM) by simulating data (and
recruitment) from this input:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co">#simulate data from operating model</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span>
<span class="va">newdata</span> <span class="op">=</span> <span class="va">om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Now put the simulated data in an input file with all the same
configuration as the operating model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp</span> <span class="op">=</span> <span class="va">input</span>
<span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">newdata</span></code></pre></div>
<p>Fit an estimation model that is the same as the operating model
(self-test).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">fit</span><span class="op">$</span><span class="va">mohns_rho</span> <span class="op">=</span> <span class="fu"><a href="../reference/mohns_rho.html">mohns_rho</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex10_plots/SSB_at_age_proportion.png" style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex10_plots/FSPR_relative.png" style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex10_plots/Kobe_status.png" style="width:30.0%"></p>
<p>Set up a SCAA estimation model (recruitment as fixed effects). The
only thing that is different is how the numbers at age are
configured.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scaa_info</span> <span class="op">=</span> <span class="va">digifish</span>
<span class="va">data_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_catch"</span>, <span class="st">"catch_paa"</span>, <span class="st">"agg_indices"</span>,<span class="st">"index_paa"</span><span class="op">)</span>
<span class="va">scaa_info</span><span class="op">[</span><span class="va">data_names</span><span class="op">]</span> <span class="op">=</span> <span class="va">newdata</span><span class="op">[</span><span class="va">data_names</span><span class="op">]</span>

<span class="co"># recruitment as fixed effects</span>
<span class="va">scaa_NAA_re</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N1_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">M</span><span class="op">$</span><span class="va">initial_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">scaa_NAA_re</span><span class="op">$</span><span class="va">use_steepness</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">scaa_NAA_re</span><span class="op">$</span><span class="va">recruit_model</span> <span class="op">=</span> <span class="fl">1</span>

<span class="va">scaa_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">scaa_info</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">scaa_NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, recruit_model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Fit the SCAA estimation model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scaa_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">scaa_input</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">scaa_fit</span><span class="op">$</span><span class="va">mohns_rho</span> <span class="op">=</span> <span class="fu"><a href="../reference/mohns_rho.html">mohns_rho</a></span><span class="op">(</span><span class="va">scaa_fit</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-2nd-operating-model-with-beverton-holt-stock-recruit-relationship">4. A 2nd operating model with Beverton-Holt stock recruit
relationship<a class="anchor" aria-label="anchor" href="#a-2nd-operating-model-with-beverton-holt-stock-recruit-relationship"></a>
</h2>
<p>Now make another operating model, <code>bh_om</code>, this time
assuming a Beverton-Holt stock recruit relationship.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NAA_re</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N1_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">M</span><span class="op">$</span><span class="va">initial_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">sigma</span> <span class="op">=</span> <span class="st">"rec"</span> <span class="co">#random about mean</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">use_steepness</span> <span class="op">=</span> <span class="fl">1</span> <span class="co">#ok because M, WAA, etc are constant</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">recruit_model</span> <span class="op">=</span> <span class="fl">3</span> <span class="co">#Beverton-Holt</span>
<span class="va">NAA_re</span><span class="op">$</span><span class="va">recruit_pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># make input object for operating model</span>
<span class="va">bh_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">digifish</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">NAA_re</span>, M <span class="op">=</span> <span class="va">M</span><span class="op">)</span>

<span class="co"># make the operating model</span>
<span class="va">bh_om</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">bh_input</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># simulate data and recruitment</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span>
<span class="va">sim_pop</span> <span class="op">=</span> <span class="va">bh_om</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">temp</span> <span class="op">=</span> <span class="va">bh_input</span>
<span class="va">temp</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="va">sim_pop</span></code></pre></div>
<p>Fit an estimation model, <code>bh_fit</code>, that matches the
operating model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bh_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">temp</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bh_fit</span><span class="op">$</span><span class="va">mohns_rho</span> <span class="op">=</span> <span class="fu"><a href="../reference/mohns_rho.html">mohns_rho</a></span><span class="op">(</span><span class="va">bh_fit</span><span class="op">)</span></code></pre></div>
<p>Set up and fit a second estimation model with recruitment as fixed
effects, i.e. with no stock recruit relationship, recruitment in each
year is a separate parameter.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scaa_info</span> <span class="op">=</span> <span class="va">digifish</span>
<span class="va">data_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_catch"</span>, <span class="st">"catch_paa"</span>, <span class="st">"agg_indices"</span>,<span class="st">"index_paa"</span><span class="op">)</span>
<span class="va">scaa_info</span><span class="op">[</span><span class="va">data_names</span><span class="op">]</span> <span class="op">=</span> <span class="va">sim_pop</span><span class="op">[</span><span class="va">data_names</span><span class="op">]</span>

<span class="co"># recruitment as fixed effects</span>
<span class="va">scaa_NAA_re</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N1_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">M</span><span class="op">$</span><span class="va">initial_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">scaa_NAA_re</span><span class="op">$</span><span class="va">use_steepness</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">scaa_NAA_re</span><span class="op">$</span><span class="va">recruit_model</span> <span class="op">=</span> <span class="fl">1</span> 

<span class="va">scaa_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">scaa_info</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">scaa_NAA_re</span>, M <span class="op">=</span> <span class="va">M</span>, recruit_model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># fit the scaa estimation model</span>
<span class="va">scaa_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">scaa_input</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">scaa_fit</span><span class="op">$</span><span class="va">mohns_rho</span> <span class="op">=</span> <span class="fu"><a href="../reference/mohns_rho.html">mohns_rho</a></span><span class="op">(</span><span class="va">scaa_fit</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="closed-loop-simulation-study">5. Closed-loop simulation study<a class="anchor" aria-label="anchor" href="#closed-loop-simulation-study"></a>
</h2>
<p>Now we do a closed-loop simulation using the beverton-holt operating
model. Catch advice is set at <span class="math inline">\(F_{40\%SPR}\)</span> during the projection
years.</p>
<p>First we use the <code>prepare_projection</code> function to set up
an input that includes projection years. We set catch in the projection
years to be nearly 0.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">om_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_projection.html">prepare_projection</a></span><span class="op">(</span><span class="va">bh_om</span>, proj.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.yrs<span class="op">=</span><span class="fl">39</span>, use.last.F<span class="op">=</span><span class="cn">FALSE</span>, use.avg.F<span class="op">=</span><span class="cn">FALSE</span>,
                use.FXSPR<span class="op">=</span><span class="cn">FALSE</span>, proj.F<span class="op">=</span><span class="cn">NULL</span>, avg.yrs<span class="op">=</span><span class="cn">NULL</span>, proj.catch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">39</span><span class="op">)</span>,
                cont.ecov<span class="op">=</span><span class="cn">TRUE</span>, use.last.ecov<span class="op">=</span><span class="cn">FALSE</span>, avg.ecov.yrs<span class="op">=</span><span class="cn">NULL</span>, proj.ecov<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Then we use <code>fit_wham</code> with <code>do.fit = FALSE</code> to
set up a TMB model that can be used to simulate a population time series
and associated catch and index observations with the stochastic
assumptions made in the <code>NAA_re</code> options that generated
<code>bh_om</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, n.newton<span class="op">=</span><span class="va">n.newton</span>, do.sdrep<span class="op">=</span><span class="cn">F</span>, do.retro<span class="op">=</span><span class="cn">F</span>, do.osa<span class="op">=</span><span class="cn">F</span>, do.check<span class="op">=</span><span class="cn">F</span>, do.proj<span class="op">=</span><span class="cn">F</span>,
  MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, save.sdrep<span class="op">=</span><span class="cn">FALSE</span>, do.fit <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>Now generate a time series of the population. A key component is to
keep the same seed for each simulation of the MSE.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span>
<span class="va">pop_om_base_period</span> <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Replace the realized abundance parameters in the operating model
input, then reset the operating model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">om_input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">log_NAA</span> <span class="op">=</span> <span class="va">pop_om_base_period</span><span class="op">$</span><span class="va">log_NAA</span>

<span class="co"># reset the om</span>
<span class="va">om</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, n.newton<span class="op">=</span><span class="va">n.newton</span>, do.sdrep<span class="op">=</span><span class="cn">F</span>, do.retro<span class="op">=</span><span class="cn">F</span>, do.osa<span class="op">=</span><span class="cn">F</span>, do.check<span class="op">=</span><span class="cn">F</span>, do.proj<span class="op">=</span><span class="cn">F</span>,
  MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, save.sdrep<span class="op">=</span><span class="cn">FALSE</span>, do.fit <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>The <code>"temp"</code> version of the operating model (red) just has
the initial recruitment value, exp(10). The <code>"om"</code> has the
full recruitment time series (black), generated using the specified
stock-recruit relationship and nearly 0 catch.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">om</span><span class="op">$</span><span class="va">years_full</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">om</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"log(Recruits (1000s))"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">om</span><span class="op">$</span><span class="va">years_full</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex10_plots/om_rec.png" style="width:80.0%"></p>
<p>Define how often an assessment (SCAA) and catch advice will be made
(3 years)</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assess.interval</span> <span class="op">=</span> <span class="fl">3</span> <span class="co">#years.step = integer()</span>
<span class="co"># yearly catch advice</span>
<span class="va">advice</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">39</span><span class="op">)</span></code></pre></div>
<p>The first advice model will be completed at the end of the base
period. The SCAA model defined as above will be updated every 3 years
(<code>assess.interval</code>) of the projection/evaluation period.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scaa_step</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">scaa_input</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># the SCAA model with actual projections to make catch advice using F40</span>
<span class="va">scaa_step_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span><span class="op">(</span><span class="va">scaa_step</span>, proj.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.yrs<span class="op">=</span><span class="fl">5</span>, use.last.F<span class="op">=</span><span class="cn">FALSE</span>, use.avg.F<span class="op">=</span><span class="cn">FALSE</span>,
            use.FXSPR<span class="op">=</span><span class="cn">TRUE</span>, proj.F<span class="op">=</span><span class="cn">NULL</span>, proj.catch<span class="op">=</span><span class="cn">NULL</span>, avg.yrs<span class="op">=</span><span class="cn">NULL</span>, avg.rec.yrs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">scaa_step</span><span class="op">$</span><span class="va">years</span>,<span class="fl">30</span><span class="op">)</span>,
            cont.ecov<span class="op">=</span><span class="cn">TRUE</span>, use.last.ecov<span class="op">=</span><span class="cn">FALSE</span>, avg.ecov.yrs<span class="op">=</span><span class="cn">NULL</span>, proj.ecov<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span>, save.sdrep<span class="op">=</span><span class="cn">FALSE</span>, MakeADFun.silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># store the OM recruitment time series at each step in the loop</span>
<span class="va">NAAtrack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">79</span>, <span class="fl">13</span><span class="op">)</span>

<span class="co"># make catcj advice for the first 3 years of the evaluation period</span>
<span class="va">advice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">assess.interval</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">scaa_step_proj</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">pred_catch</span><span class="op">[</span><span class="va">scaa_step_proj</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_years_model</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, <span class="va">assess.interval</span><span class="op">)</span></code></pre></div>
<p>The feedback loop will use the estimation model catch advice to fish
at <span class="math inline">\(F_{40}\)</span> for the 3-year projection
period. This will reduce the stock in the OM, which reduces the realized
recruitment. This plot will show the (lower) OM recruitment time series
updated at the assessment interval.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">39</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># set up projection of operating model</span>
    <span class="va">om_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_projection.html">prepare_projection</a></span><span class="op">(</span><span class="va">bh_om</span>, proj.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.yrs<span class="op">=</span><span class="fl">39</span>, use.last.F<span class="op">=</span><span class="cn">FALSE</span>, use.avg.F<span class="op">=</span><span class="cn">FALSE</span>,
                use.FXSPR<span class="op">=</span><span class="cn">FALSE</span>, proj.F<span class="op">=</span><span class="cn">NULL</span>, proj.catch<span class="op">=</span><span class="va">advice</span>, avg.yrs<span class="op">=</span><span class="cn">NULL</span>,
                cont.ecov<span class="op">=</span><span class="cn">TRUE</span>, use.last.ecov<span class="op">=</span><span class="cn">FALSE</span>, avg.ecov.yrs<span class="op">=</span><span class="cn">NULL</span>, proj.ecov<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>
    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">om_input</span>, n.newton<span class="op">=</span><span class="va">n.newton</span>, do.sdrep<span class="op">=</span><span class="cn">F</span>, do.retro<span class="op">=</span><span class="cn">F</span>, do.osa<span class="op">=</span><span class="cn">F</span>, do.check<span class="op">=</span><span class="cn">F</span>, do.proj<span class="op">=</span><span class="cn">F</span>,
    MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, save.sdrep<span class="op">=</span><span class="cn">FALSE</span>, do.fit <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span>
    <span class="va">updated_sim</span> <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>complete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">om_input</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">log_NAA</span> <span class="op">=</span> <span class="va">updated_sim</span><span class="op">$</span><span class="va">log_NAA</span>
    <span class="va">NAAtrack</span><span class="op">[</span>,<span class="va">y</span><span class="op">/</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">updated_sim</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">om</span><span class="op">$</span><span class="va">years_full</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span> <span class="fl">39</span><span class="op">)</span><span class="op">[</span><span class="va">y</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

    <span class="co"># increase terminal year</span>
    <span class="va">scaa_info_step</span> <span class="op">=</span> <span class="fu">make_digifish</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">digifish</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">+</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
    <span class="va">scaa_info_step</span><span class="op">$</span><span class="va">agg_catch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">agg_catch</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">agg_catch_proj</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">y</span>,,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span><span class="op">)</span>
    <span class="va">scaa_info_step</span><span class="op">$</span><span class="va">agg_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">agg_indices</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">agg_indices_proj</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">y</span>,,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span><span class="op">)</span>
    <span class="va">scaa_info_step</span><span class="op">$</span><span class="va">catch_paa</span> <span class="op">=</span> <span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html" class="external-link">abind</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">catch_paa</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">catch_paa_proj</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">y</span>,,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span>, along <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
    <span class="va">scaa_info_step</span><span class="op">$</span><span class="va">index_paa</span> <span class="op">=</span> <span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html" class="external-link">abind</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">index_paa</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">index_paa_proj</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">y</span>,,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span>, along <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

    <span class="va">step_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span><span class="op">(</span>basic_info <span class="op">=</span> <span class="va">scaa_info_step</span>, selectivity <span class="op">=</span> <span class="va">selectivity</span>, NAA_re <span class="op">=</span> <span class="va">scaa_NAA_re</span>, M <span class="op">=</span> <span class="va">M</span><span class="op">)</span>
    <span class="va">scaa_step</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span><span class="op">(</span><span class="va">step_input</span>, do.osa <span class="op">=</span> <span class="cn">FALSE</span>, MakeADFun.silent <span class="op">=</span> <span class="cn">TRUE</span>, retro.silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">scaa_step_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span><span class="op">(</span><span class="va">scaa_step</span>, proj.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.yrs<span class="op">=</span><span class="fl">5</span>, use.last.F<span class="op">=</span><span class="cn">FALSE</span>, use.avg.F<span class="op">=</span><span class="cn">FALSE</span>,
                use.FXSPR<span class="op">=</span><span class="cn">TRUE</span>, proj.F<span class="op">=</span><span class="cn">NULL</span>, proj.catch<span class="op">=</span><span class="cn">NULL</span>, avg.yrs<span class="op">=</span><span class="cn">NULL</span>, avg.rec.yrs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">scaa_step</span><span class="op">$</span><span class="va">years</span>,<span class="fl">30</span><span class="op">)</span>,
                cont.ecov<span class="op">=</span><span class="cn">TRUE</span>, use.last.ecov<span class="op">=</span><span class="cn">FALSE</span>, avg.ecov.yrs<span class="op">=</span><span class="cn">NULL</span>, proj.ecov<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span>, save.sdrep<span class="op">=</span><span class="cn">FALSE</span>, MakeADFun.silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

    <span class="va">advice</span><span class="op">[</span><span class="va">y</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">assess.interval</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">scaa_step_proj</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">pred_catch</span><span class="op">[</span><span class="va">scaa_step_proj</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_years_model</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, <span class="va">assess.interval</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex10_plots/om_updated_rec.png" style="width:80.0%"></p>
<p>Now compare the original OM simulated pop with <span class="math inline">\(F\)</span> = 0 (purple) to the estimation model
re-fit at 3-year time intervals providing catch advice equal to <span class="math inline">\(F_{40}\)</span> (teal).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">pal</span> <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pop_om_base_period</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"log(recruits)"</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">NAAtrack</span><span class="op">[</span>,<span class="fl">13</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="va">pop_om_base_period</span><span class="op">$</span><span class="va">SSB</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"SSB"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">450000</span><span class="op">)</span>, col  <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">SSB</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="va">pop_om_base_period</span><span class="op">$</span><span class="va">pred_catch</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"Catch (mt)"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">80000</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">pred_catch</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="va">scaa_info_step</span><span class="op">$</span><span class="va">agg_catch</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="va">y.max</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">*</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">FAA_tot</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">log_FMSY</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years_full</span>, <span class="va">updated_sim</span><span class="op">$</span><span class="va">FAA_tot</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">updated_sim</span><span class="op">$</span><span class="va">log_FMSY</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">y.max</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"F/FMSY"</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">'red'</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/devel/vignettes/ex10_plots/om_mse.png" style="width:80.0%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tim Miller, Brian Stock.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
